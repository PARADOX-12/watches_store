<section id="slideshow-{{ section.id }}" class="custom-slideshow">

  <div class="slides-wrapper">

    {% for block in section.blocks %}
      <a 
        class="slide"
        href="{% if block.settings.collection %}{{ block.settings.collection.url }}{% else %}#{% endif %}"
        {{ block.shopify_attributes }}
      >
        <img
          src="{{ block.settings.image | image_url: width: 2000 }}"
          alt="{{ block.settings.alt | escape }}"
          width="{{ block.settings.image.width }}"
          height="{{ block.settings.image.height }}"
          loading="lazy"
        >
      </a>
    {% endfor %}

    <!-- Arrows -->
    <button class="arrow prev" onclick="prevSlide_{{ section.id }}()">&#10094;</button>
    <button class="arrow next" onclick="nextSlide_{{ section.id }}()">&#10095;</button>

  </div>

</section>


<style>
    *{
        margin: 0px;
        padding: 0px
    }

#slideshow-{{ section.id }} {
  position: relative;
  width: 100%;
  overflow: hidden;
}

.slides-wrapper {
  position: relative;
  width: 100%;
  min-height: 300px; 
}

.slide {
  position : relative;
  width: 100%;
  top: 0;
  left: 0;
  display: flex;
}

.slide img {
  width: 100%;
  height: auto;
  display: block;
}

/* Arrows */
.arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255,255,255,0.4);
  border: none;
  font-size: 32px;
  padding: 12px 18px;
  cursor: pointer;
  border-radius: 50%;
  z-index: 10;
}

.arrow.prev { left: 15px; }
.arrow.next { right: 15px; }

.arrow:hover {
  background: rgba(255,255,255,0.7);
}
</style>


<script>
let index_{{ section.id }} = 0;

let slideIndex_{{ section.id }} = 0;
let slideIndex_{{ section.id }} = 0;

// Show slide by index
function showSlide_{{ section.id }}(n) {
  const slides = document.querySelectorAll('#slideshow-{{ section.id }} .slide');
  console.log(slides, "+++++++++++++++++++++++++++++++++++++++")

  if (slides.length === 0) return;

  // Fix index overflow
  if (n >= slides.length) slideIndex_{{ section.id }} = 0;
  if (n < 0) slideIndex_{{ section.id }} = slides.length - 1;

  // Hide all slides
  slides.forEach(s => s.style.display = "none");

  // Show active slide
  slides[slideIndex_{{ section.id }}].style.display = "block";
}

// Auto-slide function
function autoSlide_{{ section.id }}() {
  const check = slideIndex_{{ section.id }}++;
  console.log(check, "-----------------------------------------")
  showSlide_{{ section.id }}(slideIndex_{{ section.id }});
}

// Next button
function nextSlide_{{ section.id }}() {
  const next = slideIndex_{{ section.id }}++;
  console.log(next, "==========================================")
  showSlide_{{ section.id }}(slideIndex_{{ section.id }});
}

// Prev button
function prevSlide_{{ section.id }}() {
  const prev = slideIndex_{{ section.id }}--;
  console.log(prev, "|||||||||||||||||||||||||||||||||||||||||||||||||")
  showSlide_{{ section.id }}(slideIndex_{{ section.id }});
}

// On page load â†’ show first slide
document.addEventListener("DOMContentLoaded", () => {
  showSlide_{{ section.id }}(slideIndex_{{ section.id }});
});

// Auto slide every 4 seconds
setInterval(() => {
  autoSlide_{{ section.id }}();
}, 4000);

</script>


{% schema %}
{
  "name": "Custom Slideshow",
  "max_blocks": 10,
  "settings": [],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Slide image" },
        { "type": "text", "id": "alt", "label": "Alt text" },
        { "type": "collection", "id": "collection", "label": "Link to collection" }
      ]
    }
  ],
  "presets": [
    { "name": "Custom Slideshow" }
  ]
}
{% endschema %}
